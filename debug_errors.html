<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artrio Error Debugger</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        .error { background: #2d1b1b; border: 1px solid #d73a49; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #1b2d1b; border: 1px solid #28a745; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .info { background: #1b1d2d; border: 1px solid #007bff; padding: 10px; margin: 10px 0; border-radius: 4px; }
        button { padding: 10px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { overflow-x: auto; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>Artrio Error Diagnostics</h1>
    <div id="output"></div>
    
    <button onclick="checkSupabaseConnection()">Test Supabase Connection</button>
    <button onclick="checkAuthState()">Check Auth State</button>
    <button onclick="checkStoredErrors()">View Stored Errors</button>
    <button onclick="clearErrors()">Clear Error Log</button>
    <button onclick="testProductionApp()">Test Production App</button>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `<pre>${new Date().toLocaleTimeString()} - ${message}</pre>`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }
        
        const supabase = window.supabase.createClient(
            'https://siqmwgeriobtlnkxfeas.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNpcW13Z2VyaW9idGxua3hmZWFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0NTA3MTMsImV4cCI6MjA3MTAyNjcxM30.Wt-9b6ohRw4hpTwT_ewov5sVWmYTFPOFtvxEOZWD8wM'
        );
        
        async function checkSupabaseConnection() {
            log('Testing Supabase connection...', 'info');
            try {
                const { data, error } = await supabase.from('profiles').select('count').limit(1);
                if (error) {
                    log(`Supabase Error: ${error.message}`, 'error');
                } else {
                    log('✅ Supabase connection successful!', 'success');
                }
            } catch (e) {
                log(`Connection Error: ${e.message}`, 'error');
            }
        }
        
        async function checkAuthState() {
            log('Checking auth state...', 'info');
            try {
                const { data: { session }, error } = await supabase.auth.getSession();
                if (error) {
                    log(`Auth Error: ${error.message}`, 'error');
                } else if (session) {
                    log(`✅ User logged in: ${session.user.email}`, 'success');
                } else {
                    log('ℹ️  No active session', 'info');
                }
            } catch (e) {
                log(`Auth Check Error: ${e.message}`, 'error');
            }
        }
        
        function checkStoredErrors() {
            log('Checking stored errors...', 'info');
            const errors = JSON.parse(localStorage.getItem('artrio_errors') || '[]');
            if (errors.length === 0) {
                log('No stored errors found', 'info');
            } else {
                log(`Found ${errors.length} stored errors:`, 'error');
                errors.forEach((error, i) => {
                    log(`Error ${i + 1}: ${error.message}\\nTimestamp: ${error.timestamp}\\nURL: ${error.url}`, 'error');
                });
            }
        }
        
        function clearErrors() {
            localStorage.removeItem('artrio_errors');
            log('✅ Error log cleared', 'success');
        }
        
        async function testProductionApp() {
            log('Testing production app...', 'info');
            try {
                const response = await fetch('https://artrio.up.railway.app/api/health');
                if (response.ok) {
                    const data = await response.text();
                    log(`✅ Production app responding: ${data}`, 'success');
                } else {
                    log(`❌ Production app error: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (e) {
                log(`Production test error: ${e.message}`, 'error');
            }
        }
        
        // Auto-run basic checks
        window.addEventListener('load', () => {
            log('Starting diagnostics...', 'info');
            checkSupabaseConnection();
            checkAuthState();
            checkStoredErrors();
        });
        
        // Capture any console errors
        const originalConsoleError = console.error;
        console.error = function(...args) {
            log(`Console Error: ${args.join(' ')}`, 'error');
            originalConsoleError.apply(console, args);
        };
    </script>
</body>
</html>